# Описание программы *prepare-scattering-matrices*
Это cli приложение для запоска которого потребется python-3.9 и такие
пакеты как numpy, pandas, click, py-libspheroid.

Все такеты кроме последнего являются стандартными и могут быть
устновлены на компьютер командой  pip install. Что касается последнего,
он приложен к проекту и находится в каталоге py-libspheroid. 

Для его работы пакет нужно установить. Для этого переходим в каталог
py-libspheroid и выполняем команду python setup.py install. Приэтом на
компьютере должен быть установлен компилятор gcc-fortran и gcc.
Если сборка пройдет успешно, программа соберет динамическую библиотеку
и установит ее в недра python.

Все, подготовительный этап завершен, можно начинать расчеты.

## Что может программа
1. Читает файл AERONET level 1.5 и для каждого распределения делает расчет матрицы мюллера и сечений рассеяния, осдабления и поглощения в приближении сферического аэрозоля (флаг --spheres) или сфероидной смеси Дубовика (отсутствие флага --spheres). Результаты расчета сораняются в папку out.

2. Берет предварительно расчитанные файлы из папки out/ и объединяет их.
   Что зесь имеется ввиду. У аэронет результаты обработки содержат, ко всему прочему, долю сферического аэрозоля. Первая часть программы вычисляет матрицу для сфер и сфероидов в отдельности (сохраняет в папку out с разными префиксами и индексом номера строки измерения из файла aeronet), вторая часть - объединяет эти матрицы воедино и создает результирующий файл с префиксом total.
   
```bash
python3 prepare-matrices.py do-alljob [--skiprows=N] [--sphericity==M] AERONET_lev15.tot
```

N - целое число от 0 до 9

M - вещественное число от 1 до 99

--skiprows указывает сколько строк нужно пропустить до начала данных

--sphericity указывает верхнюю границу отсечки для сферичности. Те данные, у которых сферичность > sphericity обрабатываься не будут.

## Что получаем на выходе
В результате выполнения программы мы получим файл с префиксом __total__, который содержит нашу матрицу рассеяния и коэффициенты рассеяния, экстинкции и ослабления для всего столба атмосферы, приведенные к единичной объемной концентрации. Технически эти коэффициенты - оптические толщи рассеяния, ослабления и поглощения, так как у AERONET нет разрешения по высоте. Для задач моделирования нам нужны именно геометрические сечения единичной частицы. Поэтому будем полагать что так и есть, но этот аэрозольный слой имеет протяженность 1 км.

## Откуда брать входные данные
Для работы программы необходимо использовать данные [AERONET](https://aeronet.gsfc.nasa.gov/new_web/download_all_v3_inversions.html) Level 1.5. Единственное, нужно быть внимательными по длинам волн. Программа настроена на работу с данными на следующих длинах волн 0.4406 0.675, 0.870 и 1.020 мкм, но на некотроых станциях AERONET данные получаются на других длинах волн. Текущая версия программы пропускает их и не обрабатывает.


